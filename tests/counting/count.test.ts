import { expect, test } from "@playwright/test";
import { autocount } from "../../src/lib/count";

const twoSeatTestCases: any = [
  {
    name: "Test 1 - Original",
    data: {
      "745983": ["A", "C", "F"],
      "382917": ["A", "D", "H", "L", "K"],
      "000111": ["A", "F", "E", "C"],
      "999888": ["A", "D", "B", "C", "H", "I", "F", "G", "L"],
      "123123": ["A", "E", "L"],
      "443523": ["A", "B", "H", "I", "J", "K", "C"],
      "789789": ["C", "B", "E", "F", "G", "H", "I", "L", "J", "K"],
      "321321": ["F", "B", "H", "I", "J", "K", "C"],
      "001234": ["C", "B", "E", "F", "G", "H"],
      "987654": ["L", "B", "J", "I", "H", "E", "D", "A"],
      "456456": ["B", "D", "C", "K", "I", "J"],
    },
    expectedWinners: ["A", "B"],
  },
  {
    name: "Test 2 - Variation",
    data: {
      // Changed 745983 to ["C", "A", "F"]
      "745983": ["C", "A", "F"],
      "382917": ["A", "D", "H", "L", "K"],
      "000111": ["A", "F", "E", "C"],
      "999888": ["A", "D", "B", "C", "H", "I", "F", "G", "L"],
      "123123": ["A", "E", "L"],
      "443523": ["A", "B", "H", "I", "J", "K", "C"],
      "789789": ["C", "B", "E", "F", "G", "H", "I", "L", "J", "K"],
      "321321": ["F", "B", "H", "I", "J", "K", "C"],
      "001234": ["C", "B", "E", "F", "G", "H"],
      "987654": ["L", "B", "J", "I", "H", "E", "D", "A"],
      "456456": ["B", "D", "C", "K", "I", "J"],
    },
    expectedWinners: ["A", "B"],
  },
  {
    name: "Test 3 - Variation",
    data: {
      // Removed A from 999888
      "745983": ["A", "C", "F"],
      "382917": ["A", "D", "H", "L", "K"],
      "000111": ["A", "F", "E", "C"],
      "999888": ["D", "B", "C", "H", "I", "F", "G", "L"],
      "123123": ["A", "E", "L"],
      "443523": ["A", "B", "H", "I", "J", "K", "C"],
      "789789": ["C", "B", "E", "F", "G", "H", "I", "L", "J", "K"],
      "321321": ["F", "B", "H", "I", "J", "K", "C"],
      "001234": ["C", "B", "E", "F", "G", "H"],
      "987654": ["L", "B", "J", "I", "H", "E", "D", "A"],
      "456456": ["B", "D", "C", "K", "I", "J"],
    },
    expectedWinners: ["A", "C"],
  },
  {
    name: "Test 4 - Variation",
    data: {
      // top preference of 321321 changed to B
      "745983": ["A", "C", "F"],
      "382917": ["A", "D", "H", "L", "K"],
      "000111": ["A", "F", "E", "C"],
      "999888": ["A", "D", "B", "C", "H", "I", "F", "G", "L"],
      "123123": ["A", "E", "L"],
      "443523": ["A", "B", "H", "I", "J", "K", "C"],
      "789789": ["C", "B", "E", "F", "G", "H", "I", "L", "J", "K"],
      "321321": ["B", "F", "H", "I", "J", "K", "C"],
      "001234": ["C", "B", "E", "F", "G", "H"],
      "987654": ["L", "B", "J", "I", "H", "E", "D", "A"],
      "456456": ["B", "D", "C", "K", "I", "J"],
    },
    expectedWinners: ["A", "B"],
  },
  {
    name: "Test 5 - Variation",
    data: {
      // Removed the 987654 ballot
      "745983": ["A", "C", "F"],
      "382917": ["A", "D", "H", "L", "K"],
      "000111": ["A", "F", "E", "C"],
      "999888": ["A", "D", "B", "C", "H", "I", "F", "G", "L"],
      "123123": ["A", "E", "L"],
      "443523": ["A", "B", "H", "I", "J", "K", "C"],
      "789789": ["C", "B", "E", "F", "G", "H", "I", "L", "J", "K"],
      "321321": ["F", "B", "H", "I", "J", "K", "C"],
      "001234": ["C", "B", "E", "F", "G", "H"],
      "456456": ["B", "D", "C", "K", "I", "J"],
    },
    expectedWinners: ["A", "C"],
  },
  {
    name: "Test 6 - Variation",
    data: {
      // 745983 changed to ["F", "C", "A"],
      // 987654 changed to ["H", "B", "J", "I", "E", "D", "A"]
      "745983": ["F", "C", "A"],
      "382917": ["A", "D", "H", "L", "K"],
      "000111": ["A", "F", "E", "C"],
      "999888": ["A", "D", "B", "C", "H", "I", "F", "G", "L"],
      "123123": ["A", "E", "L"],
      "443523": ["A", "B", "H", "I", "J", "K", "C"],
      "789789": ["C", "B", "E", "F", "G", "H", "I", "L", "J", "K"],
      "321321": ["F", "B", "H", "I", "J", "K", "C"],
      "001234": ["C", "B", "E", "F", "G", "H"],
      "987654": ["H", "B", "J", "I", "E", "D", "A"],
      "456456": ["B", "D", "C", "K", "I", "J"],
    },
    expectedWinners: ["A", "B"],
  },
  {
    name: "Test 7 - Variation",
    data: {
      // Removed 999888, changed 000111
      "745983": ["A", "C", "F"],
      "382917": ["A", "D", "H", "L", "K"],
      "000111": ["F", "E", "C", "A"],
      "123123": ["A", "E", "L"],
      "443523": ["A", "B", "H", "I", "J", "K", "C"],
      "789789": ["C", "B", "E", "F", "G", "H", "I", "L", "J", "K"],
      "321321": ["F", "B", "H", "I", "J", "K", "C"],
      "001234": ["C", "B", "E", "F", "G", "H"],
      "987654": ["L", "B", "J", "I", "H", "E", "D", "A"],
      "456456": ["B", "D", "C", "K", "I", "J"],
    },
    expectedWinners: ["A", "C"],
  },
  {
    name: "Test 8 - Variation",
    data: {
      // Two new ballots: 111222 and 222333
      "745983": ["A", "C", "F"],
      "382917": ["A", "D", "H", "L", "K"],
      "000111": ["A", "F", "E", "C"],
      "999888": ["A", "D", "B", "C", "H", "I", "F", "G", "L"],
      "123123": ["A", "E", "L"],
      "443523": ["A", "B", "H", "I", "J", "K", "C"],
      "789789": ["C", "B", "E", "F", "G", "H", "I", "L", "J", "K"],
      "321321": ["F", "B", "H", "I", "J", "K", "C"],
      "001234": ["C", "B", "E", "F", "G", "H"],
      "987654": ["L", "B", "J", "I", "H", "E", "D", "A"],
      "456456": ["B", "D", "C", "K", "I", "J"],
      "111222": ["B", "C", "D", "A", "F"],
      "222333": ["C", "F", "E", "B", "A"],
    },
    expectedWinners: ["A", "B"],
  },
  {
    name: "Test 9 - Variation",
    data: {
      // Reordered 382917 drastically
      "745983": ["A", "C", "F"],
      "382917": ["L", "K", "H", "D", "A"],
      "000111": ["A", "F", "E", "C"],
      "999888": ["A", "D", "B", "C", "H", "I", "F", "G", "L"],
      "123123": ["A", "E", "L"],
      "443523": ["A", "B", "H", "I", "J", "K", "C"],
      "789789": ["C", "B", "E", "F", "G", "H", "I", "L", "J", "K"],
      "321321": ["F", "B", "H", "I", "J", "K", "C"],
      "001234": ["C", "B", "E", "F", "G", "H"],
      "987654": ["L", "B", "J", "I", "H", "E", "D", "A"],
      "456456": ["B", "D", "C", "K", "I", "J"],
    },
    expectedWinners: ["A", "B"],
  },
  {
    name: "Test 10 - Variation",
    data: {
      // Removed B from all ballots
      "745983": ["A", "C", "F"],
      "382917": ["A", "D", "H", "L", "K"],
      "000111": ["A", "F", "E", "C"],
      "999888": ["A", "D", "C", "H", "I", "F", "G", "L"],
      "123123": ["A", "E", "L"],
      "443523": ["A", "H", "I", "J", "K", "C"],
      "789789": ["C", "E", "F", "G", "H", "I", "L", "J", "K"],
      "321321": ["F", "H", "I", "J", "K", "C"],
      "001234": ["C", "E", "F", "G", "H"],
      "987654": ["L", "J", "I", "H", "E", "D", "A"],
      "456456": ["D", "C", "K", "I", "J"],
    },
    expectedWinners: ["A", "C"],
  },
];

test.describe("Count Votes", () => {
  for (let t of twoSeatTestCases) {
    test(t.name, async () => {
      let res = autocount(t.data, 2);
      expect(res).toEqual(expect.arrayContaining(t.expectedWinners));
    });
  }
});
